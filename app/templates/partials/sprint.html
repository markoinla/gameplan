<div class="card mb-3 sprint-card" data-sprint-id="{{ sprint.id }}"
     x-data="{ sprintOpen: {% if sprint.status == 'Active' %}true{% else %}false{% endif %} }"
     :class="{ 'sprint-open': sprintOpen }">
    <!-- Sprint Header - Collapsible with Alpine.js -->
    <div class="sprint-container">
        <div class="card-header d-flex justify-content-between align-items-center sprint-header cursor-pointer" 
             @click="sprintOpen = !sprintOpen">
            <div>
                <span class="sprint-name">{{ sprint.name }}</span>
                <small class="text-muted ms-2">(Created: {{ sprint.created_at.strftime('%Y-%m-%d') if sprint.created_at else '' }})</small>
                <span class="badge 
                    {% if sprint.status == 'Planned' %}bg-secondary
                    {% elif sprint.status == 'Active' %}bg-primary
                    {% elif sprint.status == 'Completed' %}bg-success
                    {% endif %}">{{ sprint.status }}</span>
            </div>
            <div class="sprint-actions">
                <button class="btn btn-sm btn-outline-secondary me-2 edit-sprint-btn" 
                        data-sprint-id="{{ sprint.id }}" 
                        @click.stop>
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger delete-sprint-btn" 
                        data-sprint-id="{{ sprint.id }}" 
                        @click.stop>
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="card-body" 
             x-show="sprintOpen">
            
            <!-- Sprint Description -->
            <div class="sprint-description mb-3">{{ sprint.description|markdown or 'No description provided.' }}</div>
            
            <!-- Tasks Section -->
            <div class="tasks-section mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">
                        Tasks
                        <small class="text-muted ms-2">
                            {{ sprint.tasks.filter_by(completed=False).count() }} Open 
                            {{ sprint.tasks.filter_by(completed=True).count() }} Done
                        </small>
                    </h5>
                    <button class="btn btn-sm btn-outline-primary add-task-btn" data-sprint-id="{{ sprint.id }}">
                        <i class="fas fa-plus me-1"></i>Add Task
                    </button>
                </div>
                <div class="tasks-container">
                    {% if sprint.tasks %}
                        {% for task in sprint.get_sorted_tasks() %}
                            <div class="task-item {% if task.completed %}completed{% endif %}" data-task-id="{{ task.id }}">
                                <div class="form-check">
                                    <input class="form-check-input task-check" type="checkbox" 
                                           {% if task.completed %}checked{% endif %} 
                                           data-task-id="{{ task.id }}">
                                    <label class="form-check-label">
                                        {{ task.details }}
                                    </label>
                                    <div class="task-actions">
                                        <button class="btn btn-sm btn-link edit-task-btn p-0 me-2" data-task-id="{{ task.id }}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-link delete-task-btn p-0" data-task-id="{{ task.id }}">
                                            <i class="fas fa-trash text-danger"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No tasks yet.</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Issues Section -->
            <div class="issues-section">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">
                        Issues
                        <small class="text-muted ms-2">
                            {{ sprint.issues.filter_by(completed=False).count() }} Open 
                            {{ sprint.issues.filter_by(completed=True).count() }} Done
                        </small>
                    </h5>
                    <button class="btn btn-sm btn-outline-primary add-issue-btn" data-sprint-id="{{ sprint.id }}">
                        <i class="fas fa-plus me-1"></i>Add Issue
                    </button>
                </div>
                <div class="issues-container">
                    {% if sprint.issues %}
                        {% for issue in sprint.get_sorted_issues() %}
                            <div class="issue-item {% if issue.completed %}completed{% endif %}" data-issue-id="{{ issue.id }}">
                                <div class="form-check">
                                    <input class="form-check-input issue-check" type="checkbox" 
                                           {% if issue.completed %}checked{% endif %} 
                                           data-issue-id="{{ issue.id }}">
                                    <label class="form-check-label">
                                        {{ issue.details }}
                                    </label>
                                    <div class="issue-actions">
                                        <button class="btn btn-sm btn-link edit-issue-btn p-0 me-2" data-issue-id="{{ issue.id }}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-link delete-issue-btn p-0" data-issue-id="{{ issue.id }}">
                                            <i class="fas fa-trash text-danger"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No issues yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
